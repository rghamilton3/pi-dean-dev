- name: Install OpenSSH server (if enabled)
  apt:
    name: openssh-server
    state: present
  when: enable_ssh

- name: Deploy hardened sshd_config
  template:
    src: sshd_config.j2
    dest: /etc/ssh/sshd_config
    mode: "0644"
  notify: Restart ssh
  when: enable_ssh

- name: Ensure SSH service state
  service:
    name: ssh
    state: "{{ 'started' if enable_ssh else 'stopped' }}"
    enabled: "{{ enable_ssh }}"
